{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="{% static 'images/crs.png' %}">
    <title>Admin Panel | {{ user.username|title }}</title>
</head>
<body>

{% block content %}

<style>
/* --- ORIGINAL CSS MO --- */
 body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg, #c0f8ff, #ddf5fc);
  margin: 0;
}
.main-content {
  background: rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border-radius: 15px;
  padding: 20px;
  margin: 20px;                                           
  box-shadow: 0 8px 32px 0 rgba(0,0,0,0.1);
}
.dashboard-container {
  display: flex;
  min-height: 100vh;
  transition: margin-left 0.3s ease;
  margin-left: 230px; 
}
.sidebar {
  width: 230px;
  background: #ddf5fc;
  box-shadow: 2px 0 8px rgba(0,0,0,0.1);
  padding: 20px;
  display: flex;
  flex-direction: column;
  position: fixed;
  top: 0;
  left: 0;
  bottom: 0;
  transform: translateX(0);
  transition: transform 0.3s ease;
  z-index: 1000;
}
.sidebar.hide { transform: translateX(-100%); }
.nav-link {
  padding: 10px 15px;
  border-radius: 8px;
  color: #333;
  text-decoration: none;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: 0.2s;
}
.nav-link:hover, .nav-link.active { background: #000000; color: #fff; }
.main-content { flex: 1; padding: 30px; }
.top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; gap: 10px; }
.search-bar { width: 300px; padding: 10px 14px; border-radius: 8px; border: 1px solid #ccc; outline: none; }
#hamburger { cursor: pointer; display: flex; flex-direction: column; justify-content: center; gap: 4px; margin-right: 10px; height: 40px; }
#hamburger div { width: 25px; height: 3px; background: #333; border-radius: 2px; }

/* Card Grid */
.card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 20px; }
.car-card { background: #fff; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); padding: 16px; transition: 0.3s; }
.car-card:hover { transform: translateY(-3px); box-shadow: 0 4px 14px rgba(0,0,0,0.15); }
.car-card img { width: 100%; height: 160px; object-fit: cover; border-radius: 8px; }
.car-info { margin-top: 10px; }
.car-info h4 { margin: 5px 0; font-size: 16px; color: #222; }
.car-info p { font-size: 13px; color: #666; margin: 3px 0; }
.card-footer { margin-top: 10px; display: flex; justify-content: space-between; align-items: center; }
.rent-btn { background: #4f46e5; color: white; border: none; padding: 8px 14px; border-radius: 8px; font-size: 13px; cursor: pointer; text-decoration: none; }
.rent-btn:hover { background: #3c36cc; }
.price { font-weight: bold; color: #111; }

/* üîπ Add Vehicle Modal Styles */
.modal { display: none; position: fixed; z-index: 10; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); }
.modal-content { background: #fff; margin: 8% auto; padding: 20px; border-radius: 10px; width: 400px; color: #333; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
.modal-content input, .modal-content textarea { width: 100%; padding: 8px; margin: 5px 0; border-radius: 6px; border: 1px solid #ccc; }
.modal-content input[type="submit"] { background: #4f46e5; color: white; font-weight: bold; border: none; cursor: pointer; }
.close { color: #333; float: right; font-size: 20px; cursor: pointer; }

/* --- üÜï KINOPYA NA LOGOUT/CONFIRM MODAL UI --- */
#customConfirmModal, #statusModal { display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); backdrop-filter: blur(4px); }
.modal-content-ui { background-color: #fff; margin: 15% auto; padding: 25px; border-radius: 12px; width: 90%; max-width: 400px; color: #333; box-shadow: 0 5px 15px rgba(0,0,0,0.3); text-align: center; }
</style>

<div class="dashboard-container">
  <div class="sidebar">
    <div class="sidebar-logo" style="text-align:center; padding: 10px;">
        <img src="{% static 'images/adminlogo.png' %}" alt="Logo" style="width:80px; height:auto;">
    </div>

    <a href="#" class="nav-link active">üè† Dashboard</a>
    <a href="/car_dealer_portal/manage_vehicles/" class="nav-link">üöò Vehicles</a>
    <a href="/car_dealer_portal/order_list/" class="nav-link">üì¶ Rentals</a>
    <a href="/car_dealer_portal/history/" class="nav-link">üí∞ Income</a>
    
    <a href="javascript:void(0)" class="nav-link" onclick="askConfirm('logout')">‚ûú Logout</a>

    <div style="margin-top:auto; padding-top:12px; border-top:1px solid rgba(0,0,0,0.06);">
      <div style="display:flex; align-items:center; gap:10px;">
        <div style="width:36px; height:36px; border-radius:50%; display:flex; align-items:center; justify-content:center; background:#e0e7ff; color:#2563eb; font-weight:700;">üë§</div>
        <div>
          <div style="font-size:12px; color:#777; margin:0;">Welcome</div>
          <div style="font-size:14px; font-weight:600; color:#333; margin-top:2px;">{{ user.username|title }}</div>
        </div>
      </div>
    </div>
  </div>

  <div class="main-content">
    <div class="top-bar">
      <div id="hamburger"><div></div><div></div><div></div></div>

      <form method="get" action="" style="flex:1; position:relative; max-width:none; margin-right:10px;">
        <input type="text" id="searchInput" name="q" class="search-bar" placeholder="Search Car Name or Model..." style="width:100%; padding:10px 50px 10px 15px; box-sizing:border-box; font-size:14px;" autocomplete="off">
        <button type="submit" style="position:absolute; right:10px; top:50%; transform:translateY(-50%); background:none; border:none; cursor:pointer;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="20" height="20">
            <path d="M480 272C480 317.9 465.1 360.3 440 394.7L566.6 521.4C579.1 533.9 579.1 554.2 566.6 566.7C554.1 579.2 533.8 579.2 521.3 566.7L394.7 440C360.3 465.1 317.9 480 272 480C157.1 480 64 386.9 64 272C64 157.1 157.1 64 272 64C386.9 64 480 157.1 480 272zM272 416C351.5 416 416 351.5 416 272C416 192.5 351.5 128 272 128C192.5 128 128 192.5 128 272C128 351.5 192.5 416 272 416z"/>
          </svg>
        </button>
        <div id="searchResults" style="position:absolute; top:100%; left:0; right:0; background:white; border:1px solid #ccc; display:none; max-height:200px; overflow-y:auto; z-index:1000;"></div>
      </form>

      <div style="margin-left:auto;">
        <span>Welcome, <b>{{ user.username }}</b></span>
      </div>
    </div>

    <button id="addVehicleBtn" class="rent-btn" style="background:#22c55e; float:right; margin-bottom:15px;">‚ûï Add Vehicle</button>

    <div class="card-grid">   
      {% for vehicle in vehicles %}
      <div class="car-card">
        {% if vehicle.image %}<img src="{{ vehicle.image.url }}" alt="{{ vehicle.car_name }}">
        {% else %}<img src="{% static 'placeholder.png' %}" alt="No image">{% endif %}
        <div class="car-info">
          <h4>{{ vehicle.car_name }}</h4>
          <p>üé® Color: {{ vehicle.color }}</p>
          <p>üö© {{ vehicle.area.city|title }}</p>
          <p>üßç Seats: {{ vehicle.capacity }}</p>
          <p>üìù {{ vehicle.description }}</p>
          <p class="price">‚Ç±{{ vehicle.price_per_day }} / day</p>
        </div>
        <div class="card-footer" style="display:flex; gap:10px;">
          <a href="/car_dealer_portal/edit_vehicle/{{ vehicle.id }}/" class="rent-btn">Edit</a>
          <button class="rent-btn" style="background:#e53e3e;" onclick="askConfirm('delete', '{{ vehicle.id }}')">Delete</button>
        </div>
      </div>
      {% empty %}<p>No vehicles posted yet.</p>{% endfor %}
    </div>
  </div>
</div>

<div id="customConfirmModal">
    <div class="modal-content-ui">
        <h4 id="confirmTitle" style="font-weight:bold;">Confirmation</h4>
        <p id="confirmText"></p>
        <div style="margin-top:20px; display:flex; gap:10px;">
            <button id="confirmYesBtn" style="flex:1; padding:10px; border:none; border-radius:6px; color:white; cursor:pointer; font-weight:bold;">Yes</button>
            <button id="confirmNoBtn" style="flex:1; padding:10px; border:none; border-radius:6px; background:#94a3b8; color:white; cursor:pointer; font-weight:bold;">No</button>
        </div>
    </div>
</div>

<div id="statusModal">
    <div class="modal-content-ui">
        <div style="font-size: 40px;">‚úîÔ∏è</div>
        <h4 style="color:#4CAF50; font-weight:bold;">Success</h4>
        <p id="statusText"></p>
    </div>
</div>

<div id="addVehicleModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h3 style="color:#000000; text-align:center;">Add New Vehicle</h3>
    <form id="addVehicleForm" action="/car_dealer_portal/add_vehicle/" method="POST" enctype="multipart/form-data">
      {% csrf_token %}
      <input type="text" name="car_name" placeholder="Car Name" required>
      <input type="text" name="color" placeholder="Color" required>
      <input type="text" name="capacity" placeholder="Capacity (e.g. 4)" required>
      <input type="text" name="city" placeholder="City" required>
      <input type="text" name="pincode" placeholder="Pincode" maxlength="6" required>
      <input type="number" name="price_per_day" placeholder="Price per Day (‚Ç±)" required>
      <textarea name="description" placeholder="Vehicle Description" rows="2" required></textarea>
      <input type="file" name="image" accept="image/*" required>
      <input type="submit" value="Add Vehicle" class="rent-btn" style="width:100%; margin-top:10px;">
    </form>
  </div>
</div>

<script>
    // --- üÜï LOGIC PARA SA LOGOUT/DELETE CONFIRMATION ---
    let currentAction = "";
    let currentId = "";

    function askConfirm(action, id = "") {
        currentAction = action;
        currentId = id;
        const yesBtn = document.getElementById('confirmYesBtn');
        document.getElementById('confirmText').innerText = (action === 'delete') ? "Are you sure you want to delete this vehicle?" : "Do you want to Logout?";
        yesBtn.style.backgroundColor = (action === 'delete') ? "#f44336" : "#2196F3";
        document.getElementById('customConfirmModal').style.display = 'block';
    }

    document.getElementById('confirmNoBtn').onclick = () => { document.getElementById('customConfirmModal').style.display = 'none'; };

    document.getElementById('confirmYesBtn').onclick = function() {
        document.getElementById('customConfirmModal').style.display = 'none';
        if(currentAction === 'delete') {
            document.getElementById('statusText').innerText = "Successfully deleted!";
            document.getElementById('statusModal').style.display = 'block';
            setTimeout(() => { window.location.href = "/car_dealer_portal/delete_vehicle/" + currentId + "/"; }, 1500);
        } else {
            window.location.href = "/car_dealer_portal/logout/";
        }
    };

    // --- Sidebar & Add Modal Logic (Original) ---
    const hamburger = document.getElementById('hamburger');
    const sidebar = document.querySelector('.sidebar');
    const dashboard = document.querySelector('.dashboard-container');
    hamburger.addEventListener('click', () => {
        sidebar.classList.toggle('hide');
        dashboard.style.marginLeft = sidebar.classList.contains('hide') ? '0' : '230px';
    });

    const modal = document.getElementById("addVehicleModal");
    const btn = document.getElementById("addVehicleBtn");
    const span = document.getElementsByClassName("close")[0];
    btn.onclick = () => modal.style.display = "block";
    span.onclick = () => modal.style.display = "none";

    // --- Search & Forms Logic (Original) ---
    const input = document.getElementById('searchInput');
    const resultsContainer = document.getElementById('searchResults');
    input.addEventListener('input', function() {
        const query = this.value.trim();
        if (!query) { resultsContainer.style.display = 'none'; return; }
        fetch(`/car_dealer_portal/search_ajax/?q=${encodeURIComponent(query)}`)
            .then(res => res.json())
            .then(data => {
                resultsContainer.innerHTML = '';
                if (data.length > 0) {
                    data.forEach(item => {
                        const div = document.createElement('div');
                        div.innerText = item.car_name;
                        div.style.padding = '5px 10px'; div.style.cursor = 'pointer';
                        div.onclick = () => { input.value = item.car_name; input.form.submit(); };
                        resultsContainer.appendChild(div);
                    });
                    resultsContainer.style.display = 'block';
                }
            });
    });
</script>

{% endblock %}
</body>
</html>