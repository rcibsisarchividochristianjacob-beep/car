{% load static %}
{% block content %}

<style>
  html, body {
    margin: 0;
    padding: 0;
    font-family: 'Poppins', sans-serif;
    background:
      linear-gradient(to right, rgba(40, 62, 81, 0.7), rgba(72, 85, 99, 0.7)),
      url("{% static 'images/rental.png' %}") no-repeat center center fixed;
    background-size: cover;
    color: #fff;
  }

  nav {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    padding: 18px 40px;
    background: rgba(255,255,255,0.06);
    backdrop-filter: blur(6px);
  }

  nav h1 {
    text-align: center;
    font-size: 22px;
    font-weight: 600;
  }

  nav a {
    color: #fff;
    text-decoration: none;
    margin-left: 20px;
  }

  nav a:hover {
    color: #a8e0ff;
  }

  table {
    border-collapse: collapse;
    width: 95%;
    max-width: 1200px;
    margin: 40px auto;
    background: rgba(255, 255, 255, 0.95);
    color: #000;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  }

  th, td {
    padding: 15px;
    text-align: center;
    border-bottom: 1px solid #ddd;
  }

  th {
    background-color: #283e51;
    color: #fff;
    font-size: 13px;
    text-transform: uppercase;
  }

  tr:nth-child(even) {
    background: #f2f2f2;
  }

  .btn-rent {
    background: #16a34a;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 6px;
    cursor: pointer;
    transition: 0.3s;
    font-weight: 600;
  }

  .btn-rent:hover {
    background: #15803d;
  }

  /* ðŸ”¹ Modal Styles */
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.6);
    justify-content: center;
    align-items: center;
  }

  .modal-content {
    background: #fff;
    color: #000;
    padding: 30px;
    border-radius: 15px;
    width: 400px;
    max-width: 90%;
    box-shadow: 0 6px 20px rgba(0,0,0,0.3);
  }

  .modal-content input, 
  .modal-content textarea, 
  .modal-content select {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-family: 'Poppins', sans-serif;
  }

  .modal-content h3 {
    text-align: center;
    margin-bottom: 10px;
  }

  .modal-content .close {
    float: right;
    font-size: 22px;
    cursor: pointer;
    color: #333;
  }

  .rent-btn {
    background-color: #16a34a;
    color: white;
    border: none;
    padding: 10px;
    border-radius: 6px;
    margin-top: 10px;
    cursor: pointer;
    width: 100%;
    font-weight: 600;
  }

  .rent-btn:hover {
    background-color: #15803d;
  }

  .payment-image {
    display: none;
    text-align: center;
    margin-top: 15px;
  }

  .payment-image img {
    width: 180px;
    height: auto;
    border-radius: 10px;
  }
</style>

<nav>
  <div><img src="{% static 'images/logo.png' %}" alt="Logo" height="60"></div>
  <div><h1>Online Car Rental System</h1></div>
  <div style="text-align:right;">
    <a href="/customer_portal/home/">Home</a>
    <a href="/customer_portal/manage/">Manage</a>
    <a href="/customer_portal/search/">Search</a>
    <a href="/customer_portal/logout/">Logout</a>
  </div>
</nav>

<h3 style="text-align:center; margin-top:30px;">Search Results</h3>

{% if request.session.vehicles_list %}
<table>
  <thead>
    <tr>
      <th>Vehicle</th>
      <th>Color</th>
      <th>Capacity</th>
      <th>Description</th>
      <th>Pincode</th>   <th>Location</th>  <th>Action</th>
    </tr>
  </thead>
  <tbody>
    {% for vehicle in request.session.vehicles_list %}
    <tr>
      <td style="font-weight: bold;">{{ vehicle.name }}</td>
      <td>{{ vehicle.color }}</td>
      <td>{{ vehicle.capacity }} Seats</td>
      <td style="font-size: 13px; color: #555;">{{ vehicle.description }}</td>
      <td><span style="background: #e2e8f0; padding: 2px 8px; border-radius: 4px;">{{ vehicle.pincode }}</span></td>
      <td>{{ vehicle.city }}</td> <td>
        <button class="btn-rent" onclick="openModal('{{ vehicle.name }}')">Rent</button>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p style="text-align:center; background: rgba(0,0,0,0.5); padding: 20px; display: inline-block; position: relative; left: 50%; transform: translateX(-50%); border-radius: 8px;">No vehicles found.</p>
{% endif %}

<div id="rentModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h3>Rent Vehicle</h3>
    
    <form id="rentForm" action="/customer_portal/confirmation/" method="POST" enctype="multipart/form-data">
      {% csrf_token %}
      <input type="hidden" id="vehicleNameInput" name="vehicle_name">

      <label>Full Name:</label>
      <input type="text" name="customer_name" placeholder="e.g. Christian Jacob Archivido" required>

      <label>Complete Address:</label>
      <input type="text" name="customer_address" placeholder="e.g. Tabang Guiguinto Bulacan" required>

      <div style="display: flex; gap: 10px;">
        <div style="flex: 1;">
          <label>Date of Rental:</label>
          <input type="date" id="rentalDate" name="rental_date" required>
        </div>
        <div style="flex: 1;">
          <label>Date of Return:</label>
          <input type="date" id="returnDate" name="return_date" required>
        </div>
      </div>

      <label>Total of Days:</label>
      <input type="text" id="totalDays" name="total_days" readonly required value="0" style="background: #eee;">

      <label>Rental Description (Destination):</label>
      <textarea name="description" rows="2" placeholder="e.g. Bulacan to Manila" required></textarea>

      <label>Payment Method:</label>
      <select id="paymentMethod" name="payment_method" required onchange="showPaymentImage()">
        <option value="">-- Select Payment --</option>
        <option value="gcash">GCash</option>
        <option value="maya">Maya</option>
        <option value="gotyme">GoTyme Bank</option>
      </select>

      <div id="gcash" class="payment-image"><img src="{% static 'images/gcash.jpg' %}"><p>Scan to pay via GCash</p></div>
      <div id="maya" class="payment-image"><img src="{% static 'images/maya.jpg' %}"><p>Scan to pay via Maya</p></div>
      <div id="gotyme" class="payment-image"><img src="{% static 'images/gotyme.jpg' %}"><p>Scan to pay via GoTyme</p></div>

      <label>Upload Payment Proof:</label>
      <input type="file" name="payment_proof" accept="image/*" required>

      <button type="submit" class="rent-btn">Confirm Rent</button>
    </form>
  </div>
</div>

<script>
  const modal = document.getElementById("rentModal");
  const vehicleNameInput = document.getElementById("vehicleNameInput");
  const rentalDateInput = document.getElementById("rentalDate");
  const returnDateInput = document.getElementById("returnDate");
  const totalDaysInput = document.getElementById("totalDays");

  function openModal(vehicleName) {
    vehicleNameInput.value = vehicleName;
    modal.style.display = "flex";
  }

  function closeModal() {
    modal.style.display = "none";
  }

  window.onclick = function(event) {
    if (event.target === modal) closeModal();
  };

  function showPaymentImage() {
    const selected = document.getElementById("paymentMethod").value;
    document.querySelectorAll('.payment-image').forEach(div => div.style.display = 'none');
    if (selected) {
      document.getElementById(selected).style.display = 'block';
    }
  }

  function calculateDays() {
    const startDate = new Date(rentalDateInput.value);
    const endDate = new Date(returnDateInput.value);

    if (rentalDateInput.value && returnDateInput.value) {
      const diffTime = endDate - startDate;
      const diffDays = Math.ceil(diffTime / (1000 * 3600 * 24)); 
      totalDaysInput.value = diffDays > 0 ? diffDays : 0;
    }
  }

  rentalDateInput.addEventListener("change", calculateDays);
  returnDateInput.addEventListener("change", calculateDays);
</script>

<!--Start of Tawk.to Script-->
<script type="text/javascript">
var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
(function(){
var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
s1.async=true;
s1.src='https://embed.tawk.to/697cd26dc28f7e1c39908c99/1jg7pbv4a';
s1.charset='UTF-8';
s1.setAttribute('crossorigin','*');
s0.parentNode.insertBefore(s1,s0);
})();
</script>
<!--End of Tawk.to Script-->
{% endblock %}